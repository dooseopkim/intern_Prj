<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FileMapper">
	<select id="findFileGroup" parameterType="String" resultType="int">
		select ifnull(max(fileGroupNum), 0) from fileGroup where flag = #{flag}
	</select>

	<insert id="insertFileGroup">
		insert into fileGroup (fileGroupNum, flag)
		values((select ifnull(max(f.fileGroupNum),0)+1 from files f), #{flag})
	</insert>
	
	<update id="insert_CB_files" parameterType="FileGroupVO">
		update fileGroup set cb_num = #{cb_num} where fileGroupNum = #{fileGroupNum}
	</update>

	<update id="insert_FB_files" parameterType="FileGroupVO">
		update fileGroup set fb_num = #{fb_num} where fileGroupNum = #{fileGroupNum}
	</update>
	
	<update id="insertBoard" parameterType="String">
		update fileGroup set flag = '-1' where flag = #{flag}
	</update>
	
	<delete id="delete_CB_Files">
		DELETE FROM fileGroup where cb_num = #{cb_num}
	</delete>

	<delete id="delete_FB_Files">
		DELETE FROM fileGroup where fb_num = #{fb_num}
	</delete>
	
	<select id="findFile" parameterType="FilesVO" resultType="int">
		select ifnull(max(file_num),0) from files where fileName = #{fileName} and fileHash = #{fileHash} and fileGroupNum = #{fileGroupNum}
	</select>
	
	<insert id="insertFile" parameterType="FilesVO">
		insert into files (fileGroupNum, file_num, filePath, fileName, fileSize, fileHash, regDate) 
		values(#{fileGroupNum}, (select ifnull(max(f.file_num),0)+1 from files f), #{filePath}, #{fileName}, #{fileSize}, #{fileHash}, #{regDate})
	</insert>
	
	<delete id="deleteFile">
		DELETE FROM files where fileGroupNum = #{fileGroupNum}
	</delete>
</mapper>